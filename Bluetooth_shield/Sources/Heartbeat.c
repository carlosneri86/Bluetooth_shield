/*HEADER******************************************************************************************
*
* Comments:
*
*
**END********************************************************************************************/
///////////////////////////////////////////////////////////////////////////////////////////////////
//                                      Includes Section                        
///////////////////////////////////////////////////////////////////////////////////////////////////
#include "derivative.h"
#include "Heartbeat.h"
#include "SW_Timer.h"
#include <stdint.h>
///////////////////////////////////////////////////////////////////////////////////////////////////
//                                   Defines & Macros Section                   
///////////////////////////////////////////////////////////////////////////////////////////////////

//! Time out in SW Timer units for the hearbeat
#define HEARTBEAT_TIMER	(HEARTBEAT_TIMEOUT/SWTIMER_BASE_TIME)

///////////////////////////////////////////////////////////////////////////////////////////////////
//                                       Typedef Section                        
///////////////////////////////////////////////////////////////////////////////////////////////////



///////////////////////////////////////////////////////////////////////////////////////////////////
//                                  Function Prototypes Section                 
///////////////////////////////////////////////////////////////////////////////////////////////////

void Heartbeat_vfnTimerCallback(void);

///////////////////////////////////////////////////////////////////////////////////////////////////
//                                   Global Constants Section                   
///////////////////////////////////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////////////////////////////////
//                                   Static Constants Section                   
///////////////////////////////////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////////////////////////////////
//                                   Global Variables Section                   
///////////////////////////////////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////////////////////////////////
//                                   Static Variables Section                   
///////////////////////////////////////////////////////////////////////////////////////////////////
//! holds the SW timer ID
static uint8_t Heartbeat_Timer = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
//                                      Functions Section                       
///////////////////////////////////////////////////////////////////////////////////////////////////

void Heartbeat_vfnInit(void)
{
	/* Request for a SW timer and start it */
	Heartbeat_Timer = SWTimer_vfnAllocateChannel(HEARTBEAT_TIMER, Heartbeat_vfnTimerCallback);
	
	SWTimer_vfnEnableTimer(Heartbeat_Timer);
}

void Heartbeat_vfnTimerCallback(void)
{
	/* Toggle the heart beat pin each time the callback is called */
	HEARTBEAT_TOGGLE_PORT = HEARTBEAT_MASK;
}
///////////////////////////////////////////////////////////////////////////////////////////////////
// EOF
///////////////////////////////////////////////////////////////////////////////////////////////////
